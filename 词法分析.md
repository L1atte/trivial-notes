## 词法分析

词法分析是把程序分割成一个个 **Token** 的过程，可以通过构造有限自动机来实现。

## 语法分析

构造 AST 的过程。分为自顶向下和自顶向上算法

## 语义分析

语义分析是消除语义模糊，生成一些属性信息，让计算机能够依据这些信息生成目标代码。

## Antler js 的 工作原理

```js
import { createServer } from 'http';
import antlr4 from 'antlr4';
const { CommonTokenStream, InputStream } = antlr4;
import ChatLexer from './ChatLexer.js';
import ChatParser from './ChatParser.js';
import HtmlChatListener from './HtmlChatListener.js';

createServer((req, res) => {
   
   res.writeHead(200, {
       'Content-Type': 'text/html',        
   });

   res.write('<html><head><meta charset="UTF-8"/></head><body>');
   
   let input = "john SHOUTS: hello @michael /pink/this will work/ :-) \n";
   let chars = new InputStream(input, true)   
   let lexer = new ChatLexer(chars);
   let tokens  = new CommonTokenStream(lexer);
   let parser = new ChatParser(tokens);
      
   parser.buildParseTrees = true;   
   let tree = parser.chat();   
   let htmlChat = new HtmlChatListener(res);
   antlr4.tree.ParseTreeWalker.DEFAULT.walk(htmlChat, tree);
   
   res.write('</body></html>');
   res.end();

}).listen(1337);
```



下面这段代码是每个 antlr 程序的基础

1. 从输入中创建字符流
2. 将字符流交给词法分析器
3. 将它们转化为 token
4. 然后交给分析器解释

```js
   let chars = new InputStream(input, true)   
   let lexer = new ChatLexer(chars);
   let tokens  = new CommonTokenStream(lexer);
   let parser = new ChatParser(tokens);
```

然后，我们将树设置为 `parser.chat()`，通常这是 parser 的第一个规则。然后，实际上你可以直接调用任何规则

```js
   parser.buildParseTrees = true;   
   let tree = parser.chat()
```

一旦我们从解析器那里得到了解析树，通常我们想用一个监听器或一个访问者来处理它。在这种情况下，我们指定一个监听器。我们特定的监听器需要一个参数：响应对象。我们想用它来把一些文本放在响应中，然后发送给用户。在设置完监听器后，我们最后用我们的监听器遍历整棵树

```js
   let htmlChat = new HtmlChatListener(res);
   antlr4.tree.ParseTreeWalker.DEFAULT.walk(htmlChat, tree);
```

### Determining the Position of the Caret（确定插入符号的位置）

